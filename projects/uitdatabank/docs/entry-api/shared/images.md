# Images

Images make your events, places and organizers stand out from the crowd and more attractive to visitors.

Online calendars typically show a thumbnail of the first image per search result, so results with images are more likely to be checked out by visitors.

In this guide you will learn how to add images to your events, places and organizers. Additionally, you'll learn how to update or remove the images afterward.

## Scope

Images can be uploaded and linked to:

* ✅ [Events](../events/introduction.md)
* ✅ [Places](../places/introduction.md)
* ✅ [Organizers](../organizers/introduction.md)

## Required permissions

Any authorized user or client can upload new images to UiTdatabank.

When creating a new [event](../events/create.md), [place](../places/create.md) or [organizer](../organizers/create.md) you can link any previously uploaded image to it.

When updating an existing [event](../events/update.md), [place](../places/update.md) or [organizer](../organizers/update.md) you can link any previously uploaded image to it if you have the necessary permission to update it.

## Uploading an image

Before you can link an image to an event, place or organizer you must first upload it via the [`POST /images`](/reference/entry.json/paths/~1images/post) endpoint.

This endpoint expects data in the `multipart/form-data` content-type, to enable the file being uploaded as binary data.

The following fields are required:

* `file`: The binary file data of the image to upload.
* `description`: A description of the image.
* `copyrightHolder`: The name of the person or entity that holds the copyright on the image. Will be used for attribution.
* `language`: The language of the image and its description. For example, an image can have some text on it in a specific language. 

### HTTP example

The snippet below is an example of how a `multipart/form-data` request with the binary file data and other required fields should look like when sent to Entry API:

```http
POST /images HTTP/1.1
Host: io-test.uitdatabank.be
Authorization: Bearer YOUR_ACCESS_TOKEN
Content-Type: multipart/form-data; boundary=---------------------------364135567725617170882159869420
Content-Length: 1898538

-----------------------------364135567725617170882159869420
Content-Disposition: form-data; name="description"

Example description
-----------------------------364135567725617170882159869420
Content-Disposition: form-data; name="copyrightHolder"

Example copyrightHolder
-----------------------------364135567725617170882159869420
Content-Disposition: form-data; name="language"

nl
-----------------------------364135567725617170882159869420
Content-Disposition: form-data; name="file"; filename="example.png"
Content-Type: image/png

<... binary file data ...>
```

Note that in this example, the `boundary` used to define the start and end of every form data field was auto-generated by the HTTP client that was used to send the request, in this case a web browser.

The `boundary` can be any string, but it is usually set automatically by the HTTP client in the programming language of your choice.

Read on for some examples in specific programming languages.

### Javascript example

First, use the [File API](https://developer.mozilla.org/en-US/docs/Web/API/File_API/Using_files_from_web_applications) to read the data of one or more files from the local filesystem. Then, use the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) to send a POST request with a [FormData object](https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects) to Entry API including the file data.

For example:

```js
// 1. Get the file data from an input[type="file"] field. (See HTML tab.)
const file = document.querySelector('#input').files[0];

// 2. Construct the form data for the POST request, including the file field.
const formData = new FormData();
formData.append('file', file);
formData.append('description', 'Example description');
formData.append('copyrightHolder', 'Example copyrightHolder');
formData.append('language', 'en');

// 3. Send the POST request and log the result to the console.
fetch('https://io-test.uitdatabank.be/images', {
  method: 'POST',
  body: formData,
  headers: {
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN'
  },
})
  .then((response) => response.json())
  .then((result) => {
    console.log('Success:', result);
  })
  .catch((error) => {
    console.error('Error:', error);
  });
```

```html
<input type="file" id="input" />
```

Note how the `content-type` and `content-length` headers are **not** set explicitly, as these must be set automatically by the Fetch API. If you do set either of them explicitly, you will receive an error from the `POST /images` endpoint because they will override the values normally set by the Fetch API based on the `boundary` that it generates randomly, and the server won't know how to parse the request correctly.

### PHP example

#### cURL

You can use PHP's built-in cURL functions to implement a file upload to Entry API.

For example:

```php
<?php

// 1. Create a new CURLFile object with a reference to a LOCAL file
$file = new CURLFile(__DIR__ . '/example.png');

// 2. Create an associative array with the form data to POST, including the file
$data = [
  'file' => $file,
  'description' => 'Example description',
  'copyrightHolder' => 'Example copyrightHolder',
  'language' => 'en',
];

// 3. Create an array with the header lines to include in the POST request
$headers = [
  'Authorization: Bearer YOUR_ACCESS_TOKEN',
];

// 4. Set up a CURL handler and necessary CURL options to make the request work    
$curlHandler = curl_init();
curl_setopt($curlHandler, CURLOPT_URL, 'https://io-test.uitdatabank.be/images/');
curl_setopt($curlHandler, CURLOPT_CUSTOMREQUEST, 'POST');
curl_setopt($curlHandler, CURLOPT_HTTPHEADER, $headers);
curl_setopt($curlHandler, CURLOPT_POSTFIELDS, $data);
curl_setopt($curlHandler, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curlHandler, CURLOPT_FOLLOWLOCATION, TRUE); // Optional, but strongly recommended
curl_setopt($curlHandler, CURLINFO_HEADER_OUT, TRUE); // Optional, to make the curl_getinfo($ch, CURLINFO_HEADER_OUT); below work for debugging

// 5. Send the request
$result = curl_exec($curlHandler);

// 6. Dump the result and some CURL info for easy debugging
var_dump([
  'result' => $result,
  'curl request headers' => curl_getinfo($curlHandler, CURLINFO_HEADER_OUT),
  'curl error' => curl_error($curlHandler),
]);

// 7. Close the CURL handler
curl_close($curlHandler);
```

Just like in the Javascript example, you do not need to set the `content-type` and `content-length` headers explicitly. Although in this case, if you do set them by accident, cURL will override them with its own values.

Note that the file path in the `CURLFile` constructor **MUST** be a local file path on the server, it cannot be a HTTP(S) URL. If you want to upload an image that is not stored on the server that you are sending the request from, you can download the remote image first using `file_get_contents()` and `file_put_contents()`. For example:

```php
$imageUrl = 'https://example.com/example.png';
$imageFileName = 'example.png';
$imageFilePath = '/tmp/' . $imageFileName;
	
file_put_contents($imageFilePath, file_get_contents($imageUrl));

$file = new CURLFile($imageFilePath);
```

#### Guzzle

Alternatively, you can use the [Guzzle library](https://docs.guzzlephp.org/en/stable/index.html) to send file upload requests.

```php
use GuzzleHttp\Client;

// 1. Create a new Guzzle client instance
$client = new Client();

// 2. Define the request headers
// See https://docs.guzzlephp.org/en/stable/request-options.html#headers
$headers = [
  'authorization' => 'Bearer YOUR_ACCESS_TOKEN',
];

// 3. Define the form data as required by Guzzle
// See https://docs.guzzlephp.org/en/stable/request-options.html#multipart
$formData = [
  [
    'name'     => 'file',
    'contents' => Psr7\Utils::tryFopen(__DIR__ . 'example.png', 'r')
  ],
  [
    'name'     => 'description',
    'contents' => 'Example description',
  ],
  [
    'name'     => 'copyrightHolder',
    'contents' => 'Example copyrightHolder',
  ],
  [
    'name'     => 'language',
    'contents' => 'en',
  ],
];

// 4. Send the POST request
$response = $client->request('POST', 'http://io-test.uitdatabank.be/images', [
  'headers' => $headers,
  'multipart' => $formData
]);

// 5. Dump the response for debugging. 
// In case of an error, Guzzle will throw an exception instead.
var_dump($response);
```

Note that just as when using cURL, the file name passed to `Psr7\Utils::tryFopen()` **MUST** be a local file path on the server. See [the cURL example above](#curl) for a solution to upload remote files with a HTTP(S) URL instead.

## Linking an image

### Events and places

You can link previously uploaded images to an event or place when creating or updating them in their entirety using the `mediaObject` property. For example:

```json
{
  "mediaObject": [
    {
      "@id": "https://io-test.uitdatabank.be/images/546a90cd-a238-417b-aa98-1b6c50c1345c"
    },
    {
      "@id": "https://io-test.uitdatabank.be/images/5cf42d51-3a4f-46f0-a8af-1cf672be8c84"
    }
  ]
}
```
*(Other event/place properties like `mainLanguage`, `name` and so on omitted for readability.)*

Afterward, UiTdatabank will automatically add more properties like its `description` and `copyrightHolder` to each `mediaObject` entry. 

Additionally, a new `image` property will be added on the event/place with the URL of the "main" image. This is the image that will be shown in online calendars on pages with search results.

For example, when fetching your event or place from Entry API later:
```json
{
  "image": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
  "mediaObject": [
    {
      "@id": "https://io-test.uitdatabank.be/images/546a90cd-a238-417b-aa98-1b6c50c1345c",
      "id": "546a90cd-a238-417b-aa98-1b6c50c1345c",
      "contentUrl": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
      "thumbnailUrl": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
      "description": "Example description",
      "copyrightHolder": "Example copyrightHolder",
      "inLanguage": "en"
    },
    {
      "@id": "https://io-test.uitdatabank.be/images/5cf42d51-3a4f-46f0-a8af-1cf672be8c84",
      "id": "5cf42d51-3a4f-46f0-a8af-1cf672be8c84",
      "contentUrl": "https://images-test.uitdatabank.be/5cf42d51-3a4f-46f0-a8af-1cf672be8c84.jpeg",
      "thumbnailUrl": "https://images-test.uitdatabank.be/5cf42d51-3a4f-46f0-a8af-1cf672be8c84.jpeg",
      "description": "Other example description",
      "copyrightHolder": "Other example copyrightHolder",
      "inLanguage": "en"
    }
  ]
}
```

Alternatively, you can use the [`POST /events/{eventId}/images`](/reference/entry.json/paths/~1events~1{eventId}~1images/post) and [`POST /places/{placeId}/images`](/reference/entry.json/paths/~1places~1{placeId}~1images/post) endpoints to add a single (previously uploaded) image to an event or place without including any other properties.

### Organizers

You can link previously uploaded images to an organizer when creating it or updating it in its entirety using the `images` property. For example:

```json
{
  "images": [
    {
      "@id": "https://io-test.uitdatabank.be/images/546a90cd-a238-417b-aa98-1b6c50c1345c"
    },
    {
      "@id": "https://io-test.uitdatabank.be/images/5cf42d51-3a4f-46f0-a8af-1cf672be8c84"
    }
  ]
}
```
*(Other event/place properties like `mainLanguage`, `name` and so on omitted for readability.)*

Afterward, UiTdatabank will automatically add more properties like its `description` and `copyrightHolder` to each `images` entry. 

Additionally, a new `mainImage` property will be added on the organizer with the URL of the "main" image. This is the image that will be shown in online calendars on pages with search results.

For example, when fetching your organizer from Entry API later:
```json
{
  "mainImage": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
  "images": [
    {
      "@id": "https://io-test.uitdatabank.be/images/546a90cd-a238-417b-aa98-1b6c50c1345c",
      "id": "546a90cd-a238-417b-aa98-1b6c50c1345c",
      "contentUrl": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
      "thumbnailUrl": "https://images-test.uitdatabank.be/546a90cd-a238-417b-aa98-1b6c50c1345c.jpeg",
      "description": "Example description",
      "copyrightHolder": "Example copyrightHolder",
      "inLanguage": "en"
    },
    {
      "@id": "https://io-test.uitdatabank.be/images/5cf42d51-3a4f-46f0-a8af-1cf672be8c84",
      "id": "5cf42d51-3a4f-46f0-a8af-1cf672be8c84",
      "contentUrl": "https://images-test.uitdatabank.be/5cf42d51-3a4f-46f0-a8af-1cf672be8c84.jpeg",
      "thumbnailUrl": "https://images-test.uitdatabank.be/5cf42d51-3a4f-46f0-a8af-1cf672be8c84.jpeg",
      "description": "Other example description",
      "copyrightHolder": "Other example copyrightHolder",
      "inLanguage": "en"
    }
  ]
}
```

Alternatively, you can use the [`POST /organizers/{organizerId}/images`](/reference/entry.json/paths/~1organizers~1{organizerId}~1images/post) endpoint to add a single (previously uploaded) image to an organizer without including any other properties.

## Changing the main image

When creating an event, place or organizer, or when updating them in their entirety, the main image is based on the first entry in the `mediaObject` property (events/places) or `images` property (organizers). So you can influence which image will become the main image, by setting it in the first position of the array.

```json
{
  "images": [
    {
      // This image will become the main image
      "@id": "https://io-test.uitdatabank.be/images/546a90cd-a238-417b-aa98-1b6c50c1345c"
    },
    {
      "@id": "https://io-test.uitdatabank.be/images/5cf42d51-3a4f-46f0-a8af-1cf672be8c84"
    }
  ]
}
```

Alternatively, you can use one of the following endpoints to change the main image to another (previously linked) image without updating any other properties:

* [`PUT /events/{eventId}/images/main`](/reference/entry.json/paths/~1events~1{eventId}~1images/main/put) for events
* [`PUT /places/{placeId}/images/main`](/reference/entry.json/paths/~1places~1{placeId}~1images/main/put) for places
* [`PUT /organizers/{organizerId}/images/main`](/reference/entry.json/paths/~1organizers~1{organizerId}~1images/main/put) for organizers

## Editing a linked image

## Removing a linked image

## Resizing an image

Coming soon. <!-- @todo link to resizing guide in Search API when finished -->

## More info

<!--
  @todo
  - Give more context and example POST /images endpoint (with form-data) 
  - Preferably also a PHP and JS example and not just curl
  - Make sure to mention that the "file" field must contain binary data, and cannot contain a URL of a remote file. Also when using curl in PHP, you cannot set it to a remote URL. You need to download it yourself first.
  - Demonstrate how to add the uploaded image/"mediaObject" to an event/place/organizer and optionally set it as the main image. Explain that you can do it both when creating/updating an event/place/organizer, or using the separate endpoint(s).
  - Permissions: Who can upload images?
  - Explain/demonstrate how to delete an image from an event/place/organizer.
  - Explain that you cannot delete the image/mediaObject itself.
-->
